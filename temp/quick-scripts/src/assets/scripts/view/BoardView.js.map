{"version":3,"sources":["assets\\scripts\\view\\BoardView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport { Board } from \"../core/Board\";\nimport { Tile } from \"../core/Tile\";\nimport { GameRules } from \"../core/GameRules\";\nimport TileView from \"./TileView\";\n\n/**\n * Визуализация игрового поля\n */\n@ccclass\nexport default class BoardView extends cc.Component {\n  @property(cc.Prefab)\n  tilePrefab: cc.Prefab = null;\n\n  @property(cc.Node)\n  fieldBorder: cc.Node = null;\n\n  @property(cc.Float)\n  cellSize: number = 100;\n\n  @property(cc.Float)\n  spacing: number = 0;\n\n  private board: Board = null;\n  private tileViews: Map<number, TileView> = new Map();\n  private onTileClickCallback: (x: number, y: number) => void;\n  private tilesContainer: cc.Node = null;\n  private maskNode: cc.Node = null;\n\n  onLoad(): void {\n    this.createMaskContainer();\n  }\n\n  private createMaskContainer(): void {\n    if (this.maskNode) {\n      return;\n    }\n\n    this.maskNode = new cc.Node(\"MaskContainer\");\n    this.maskNode.parent = this.node;\n    this.maskNode.anchorX = 0.5;\n    this.maskNode.anchorY = 1;\n    this.maskNode.setPosition(0, -62);\n\n    const mask = this.maskNode.addComponent(cc.Mask);\n    mask.type = cc.Mask.Type.RECT;\n\n    this.tilesContainer = new cc.Node(\"TilesContainer\");\n    this.tilesContainer.parent = this.maskNode;\n    this.tilesContainer.anchorX = 0.5;\n    this.tilesContainer.anchorY = 1;\n    this.tilesContainer.setPosition(0, 0);\n  }\n\n  init(board: Board, onTileClick: (x: number, y: number) => void): void {\n    this.board = board;\n    this.onTileClickCallback = onTileClick;\n\n    this.createMaskContainer();\n\n    const totalSize = this.cellSize + this.spacing;\n    const fieldWidth = this.board.cols * totalSize;\n    const fieldHeight = this.board.rows * totalSize;\n\n    this.node.width = fieldWidth;\n    this.node.height = fieldHeight;\n\n    const tileOverhang = 6;\n    if (this.maskNode) {\n      this.maskNode.width = fieldWidth;\n      this.maskNode.height = fieldHeight + tileOverhang;\n    }\n\n    this.updateFieldBorderSize();\n    this.renderBoard();\n  }\n\n  private updateFieldBorderSize(): void {\n    if (!this.fieldBorder) return;\n\n    const fieldSize = this.calculateFieldSize();\n    const scale = this.fieldBorder.scale;\n    this.fieldBorder.width = fieldSize.width / scale;\n    this.fieldBorder.height = fieldSize.height / scale;\n  }\n\n  private calculateFieldSize(): cc.Size {\n    const totalSize = this.cellSize + this.spacing;\n\n    const width =\n      this.board.cols * totalSize -\n      this.spacing +\n      GameRules.FIELD_PADDING_SIDE * 2;\n\n    const height =\n      this.board.rows * totalSize -\n      this.spacing +\n      GameRules.FIELD_PADDING_TOP +\n      GameRules.FIELD_PADDING_BOTTOM;\n\n    return cc.size(width, height);\n  }\n\n  renderBoard(): void {\n    if (this.tilesContainer) {\n      this.tilesContainer.removeAllChildren();\n    }\n\n    this.tileViews.clear();\n\n    for (let x = 0; x < this.board.cols; x++) {\n      for (let y = 0; y < this.board.rows; y++) {\n        const tile = this.board.getTile(x, y);\n        if (tile) {\n          this.createTileView(tile);\n        }\n      }\n    }\n  }\n\n  private createTileView(tile: Tile): TileView {\n    const tileNode = cc.instantiate(this.tilePrefab);\n    const tileView = tileNode.getComponent(TileView);\n\n    tileView.setTile(tile);\n    const pos = this.gridToWorldPosition(tile.gridX, tile.gridY);\n    tileView.setPosition(pos.x, pos.y);\n\n    tileNode.on(\n      cc.Node.EventType.TOUCH_END,\n      () => {\n        this.onTileClicked(tile.gridX, tile.gridY);\n      },\n      this,\n    );\n\n    if (this.tilesContainer) {\n      this.tilesContainer.addChild(tileNode);\n    }\n\n    this.tileViews.set(tile.id, tileView);\n    return tileView;\n  }\n\n  private onTileClicked(x: number, y: number): void {\n    if (this.onTileClickCallback) {\n      this.onTileClickCallback(x, y);\n    }\n  }\n\n  private gridToWorldPosition(gridX: number, gridY: number): cc.Vec2 {\n    const totalSize = this.cellSize + this.spacing;\n    const offsetX = -(this.board.cols * totalSize) / 2 + this.cellSize / 2;\n\n    const gridHeight = this.board.rows * totalSize;\n    const offsetY = -gridHeight / 2 + this.cellSize / 2;\n    const extraOffsetY = -gridHeight / 2;\n\n    return cc.v2(\n      gridX * totalSize + offsetX,\n      gridY * totalSize + offsetY + extraOffsetY,\n    );\n  }\n\n  animateRemoval(tiles: Tile[], callback: Function): void {\n    let completed = 0;\n    const total = tiles.length;\n\n    for (const tile of tiles) {\n      const tileView = this.tileViews.get(tile.id);\n\n      if (tileView) {\n        this.tileViews.delete(tile.id);\n\n        tileView.playDestroyAnimation(() => {\n          completed++;\n          if (completed === total && callback) {\n            callback();\n          }\n        });\n      }\n    }\n\n    if (total === 0 && callback) {\n      callback();\n    }\n  }\n\n  animateGravityWithPositions(\n    oldPositions: Map<number, { x: number; y: number }>,\n    callback: Function,\n  ): void {\n    const animations: Promise<void>[] = [];\n\n    for (let x = 0; x < this.board.cols; x++) {\n      for (let y = 0; y < this.board.rows; y++) {\n        const tile = this.board.getTile(x, y);\n        if (tile && tile.isSuper() && !this.tileViews.has(tile.id)) {\n          this.createTileView(tile);\n        }\n      }\n    }\n\n    for (let x = 0; x < this.board.cols; x++) {\n      for (let y = 0; y < this.board.rows; y++) {\n        const tile = this.board.getTile(x, y);\n        if (!tile) continue;\n\n        const oldPos = oldPositions.get(tile.id);\n        const tileView = this.tileViews.get(tile.id);\n\n        if (!oldPos && !tileView) {\n          animations.push(this.createNewTileWithAnimation(tile, x, y));\n        } else if (tileView && oldPos && (oldPos.x !== x || oldPos.y !== y)) {\n          animations.push(this.animateExistingTile(tileView, x, y));\n        }\n      }\n    }\n\n    if (animations.length > 0) {\n      Promise.all(animations).then(() => {\n        if (callback) callback();\n      });\n    } else {\n      if (callback) callback();\n    }\n  }\n\n  private createNewTileWithAnimation(\n    tile: Tile,\n    gridX: number,\n    gridY: number,\n  ): Promise<void> {\n    return new Promise((resolve) => {\n      const tileView = this.createTileView(tile);\n\n      const startY = this.board.rows + (this.board.rows - gridY) * 0.3;\n      const startPos = this.gridToWorldPosition(gridX, startY);\n      const targetPos = this.gridToWorldPosition(gridX, gridY);\n\n      tileView.node.setPosition(cc.v3(startPos.x, startPos.y, 0));\n      tileView.node.opacity = 255;\n\n      const delay = gridX * 0.05;\n      const duration = 0.4 + gridY * 0.05;\n\n      cc.tween(tileView.node)\n        .delay(delay)\n        .to(\n          duration,\n          {\n            position: cc.v3(targetPos.x, targetPos.y, 0),\n          },\n          { easing: \"bounceOut\" },\n        )\n        .call(() => resolve())\n        .start();\n    });\n  }\n\n  createSuperTileWithAppearAnimation(superTile: Tile): void {\n    const tileView = this.createTileView(superTile);\n\n    tileView.node.scale = 0;\n    tileView.node.opacity = 255;\n\n    cc.tween(tileView.node)\n      .to(0.3, { scale: 1.2 }, { easing: \"backOut\" })\n      .to(0.1, { scale: 1.0 }, { easing: \"sineInOut\" })\n      .start();\n  }\n\n  private animateExistingTile(\n    tileView: TileView,\n    gridX: number,\n    gridY: number,\n  ): Promise<void> {\n    return new Promise((resolve) => {\n      const targetPos = this.gridToWorldPosition(gridX, gridY);\n\n      cc.tween(tileView.node)\n        .to(\n          0.1,\n          {\n            position: cc.v3(targetPos.x, targetPos.y, 0),\n          },\n          { easing: \"quadIn\" },\n        )\n        .call(() => resolve())\n        .start();\n    });\n  }\n\n  animateAllTilesRemoval(callback: Function): void {\n    const allTileViews = Array.from(this.tileViews.values());\n\n    if (allTileViews.length === 0) {\n      if (callback) callback();\n      return;\n    }\n\n    let completed = 0;\n    const total = allTileViews.length;\n\n    allTileViews.forEach((tileView, index) => {\n      const delay = index * 0.01;\n\n      this.scheduleOnce(() => {\n        tileView.playDestroyAnimation(() => {\n          completed++;\n          if (completed === total && callback) {\n            callback();\n          }\n        });\n      }, delay);\n    });\n\n    this.tileViews.clear();\n  }\n\n  private getTileView(tileId: number): TileView | null {\n    return this.tileViews.get(tileId) || null;\n  }\n}\n"]}