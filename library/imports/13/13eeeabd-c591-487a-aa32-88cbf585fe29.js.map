{"version":3,"sources":["assets\\scripts\\view\\TileView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport { SuperTileType, Tile } from \"../core/Tile\";\nimport { TileColor } from \"../core/TileColor\";\n\n/**\n * Визуальный компонент тайла\n */\n@ccclass\nexport default class TileView extends cc.Component {\n  @property(cc.Sprite)\n  sprite: cc.Sprite = null;\n\n  @property([cc.SpriteFrame])\n  tileTextures: cc.SpriteFrame[] = [];\n\n  @property([cc.SpriteFrame])\n  superTileTextures: cc.SpriteFrame[] = [];\n\n  private tile: Tile = null;\n\n  setTile(tile: Tile): void {\n    this.tile = tile;\n    this.updateVisual();\n  }\n\n  getTile(): Tile {\n    return this.tile;\n  }\n\n  private updateVisual(): void {\n    if (!this.tile || !this.sprite) return;\n\n    if (this.tile.isSuper()) {\n      this.setSuperTileVisual();\n      return;\n    }\n\n    const colorIndexMap = {\n      [TileColor.RED]: 0,\n      [TileColor.BLUE]: 1,\n      [TileColor.GREEN]: 2,\n      [TileColor.YELLOW]: 3,\n      [TileColor.PURPLE]: 4,\n    };\n\n    const index = colorIndexMap[this.tile.color];\n\n    if (this.tileTextures.length > 0 && this.tileTextures[index]) {\n      this.sprite.spriteFrame = this.tileTextures[index];\n      this.sprite.node.color = cc.Color.WHITE;\n    } else {\n      const colorMap = {\n        [TileColor.RED]: cc.Color.RED,\n        [TileColor.BLUE]: cc.Color.BLUE,\n        [TileColor.GREEN]: cc.Color.GREEN,\n        [TileColor.YELLOW]: cc.Color.YELLOW,\n        [TileColor.PURPLE]: new cc.Color(150, 50, 200),\n      };\n      this.sprite.node.color = colorMap[this.tile.color] || cc.Color.WHITE;\n    }\n  }\n\n  private setSuperTileVisual(): void {\n    const superIndexMap = {\n      [SuperTileType.ROW_BLAST]: 0,\n      [SuperTileType.COLUMN_BLAST]: 1,\n      [SuperTileType.BOMB]: 2,\n      [SuperTileType.MEGA_BLAST]: 3,\n    };\n\n    const index = superIndexMap[this.tile.superType];\n\n    if (this.superTileTextures.length > 0 && this.superTileTextures[index]) {\n      this.sprite.spriteFrame = this.superTileTextures[index];\n      this.sprite.node.color = cc.Color.WHITE;\n    } else {\n      this.updateVisual();\n      this.sprite.node.color = cc.Color.WHITE;\n      this.sprite.node.opacity = 255;\n      this.addSuperTileEffect();\n    }\n  }\n\n  private addSuperTileEffect(): void {\n    cc.tween(this.node)\n      .repeatForever(\n        cc\n          .tween()\n          .to(0.5, { scale: 1.1 }, { easing: \"sineInOut\" })\n          .to(0.5, { scale: 1.0 }, { easing: \"sineInOut\" }),\n      )\n      .start();\n  }\n\n  setPosition(x: number, y: number): void {\n    this.node.setPosition(x, y);\n  }\n\n  playDestroyAnimation(callback: Function): void {\n    cc.tween(this.node)\n      .to(0.2, { scale: 0, opacity: 0 })\n      .call(() => {\n        this.node.destroy();\n        if (callback) callback();\n      })\n      .start();\n  }\n\n  playFallAnimation(\n    targetX: number,\n    targetY: number,\n    duration: number,\n    callback?: Function,\n  ): void {\n    cc.tween(this.node)\n      .to(\n        duration,\n        { position: cc.v3(targetX, targetY, 0) },\n        { easing: \"bounceOut\" },\n      )\n      .call(() => {\n        if (callback) callback();\n      })\n      .start();\n  }\n}\n"]}