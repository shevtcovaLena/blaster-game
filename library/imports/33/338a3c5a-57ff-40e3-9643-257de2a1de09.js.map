{"version":3,"sources":["assets\\scripts\\controllers\\GameController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport { Board } from \"../core/Board\";\nimport { GameState, GameStatus } from \"../core/GameState\";\nimport { GameRules } from \"../core/GameRules\";\nimport BoardView from \"../view/BoardView\";\nimport GameEndPanel, { GameEndType } from \"../ui/GameEndPanel\";\nimport { SuperTileType, Tile } from \"../core/Tile\";\n\n/**\n * Главный контроллер игры\n * Связывает модель (Board, GameState) с отображением (BoardView)\n */\n@ccclass\nexport default class GameController extends cc.Component {\n  @property(BoardView)\n  boardView: BoardView = null;\n\n  @property(cc.Label)\n  scoreLabel: cc.Label = null;\n\n  @property(cc.Label)\n  movesLabel: cc.Label = null;\n\n  @property(cc.Node)\n  gameEndPanelNode: cc.Node = null;\n\n  private gameEndPanel: GameEndPanel = null;\n  private board: Board;\n  private gameState: GameState;\n\n  onLoad() {\n    this.board = new Board(GameRules.GRID_COLS, GameRules.GRID_ROWS);\n    this.gameState = new GameState();\n\n    this.board.generate();\n    this.boardView.init(this.board, this.onTileClicked.bind(this));\n    this.updateUI();\n  }\n\n  start() {\n    if (this.gameEndPanelNode) {\n      this.gameEndPanel = this.gameEndPanelNode.getComponent(GameEndPanel);\n    }\n  }\n\n  /**\n   * Обработчик клика по тайлу\n   */\n  private onTileClicked(x: number, y: number): void {\n    if (!this.gameState.isPlaying()) {\n      return;\n    }\n\n    const clickedTile = this.board.getTile(x, y);\n    if (!clickedTile) return;\n\n    if (clickedTile.isSuper()) {\n      this.activateSuperTile(clickedTile);\n      return;\n    }\n\n    const group = this.board.findConnectedGroup(x, y);\n\n    if (!GameRules.isValidGroup(group.length)) {\n      return;\n    }\n\n    const shouldCreateSuper = GameRules.shouldCreateSuperTile(group.length);\n    const superType = GameRules.getSuperTileType(group.length);\n    const clickColor = clickedTile.color;\n    const clickX = x;\n    const clickY = y;\n\n    this.boardView.animateRemoval(group, () => {\n      this.board.removeTiles(group);\n\n      if (shouldCreateSuper && superType !== SuperTileType.NONE) {\n        const superTile = this.board.createSuperTile(\n          clickX,\n          clickY,\n          superType,\n          clickColor,\n        );\n        this.boardView.createSuperTileWithAppearAnimation(superTile);\n      }\n\n      this.scheduleOnce(() => {\n        const oldPositions = this.saveOldPositions();\n        this.board.applyGravity();\n\n        this.boardView.animateGravityWithPositions(oldPositions, () => {\n          this.gameState.addScore(group.length);\n          this.gameState.useMove();\n          this.gameState.checkEndConditions(this.board);\n          this.updateUI();\n          this.checkShuffleOrGameEnd();\n        });\n      }, 0.3);\n    });\n  }\n\n  /**\n   * Активировать эффект супер-тайла с цепной реакцией\n   */\n  private activateSuperTile(superTile: Tile): void {\n    const tilesToRemove = this.getTilesForSuperEffect(superTile);\n\n    if (tilesToRemove.length === 0) return;\n\n    const triggeredSuperTiles = tilesToRemove.filter(\n      (tile) => tile.isSuper() && tile.id !== superTile.id,\n    );\n\n    this.boardView.animateRemoval(tilesToRemove, () => {\n      this.board.removeTiles(tilesToRemove);\n\n      if (triggeredSuperTiles.length > 0) {\n        this.scheduleOnce(() => {\n          const secondWaveTiles = this.collectSecondWaveTiles(\n            triggeredSuperTiles,\n          );\n\n          if (secondWaveTiles.length > 0) {\n            this.boardView.animateRemoval(secondWaveTiles, () => {\n              this.board.removeTiles(secondWaveTiles);\n              this.applyGravityAndFinish(\n                tilesToRemove.length + secondWaveTiles.length,\n              );\n            });\n          } else {\n            this.applyGravityAndFinish(tilesToRemove.length);\n          }\n        }, 0.1);\n      } else {\n        this.applyGravityAndFinish(tilesToRemove.length);\n      }\n    });\n  }\n\n  /**\n   * Собрать тайлы для второй волны цепной реакции\n   */\n  private collectSecondWaveTiles(triggeredSuperTiles: Tile[]): Tile[] {\n    const secondWaveTiles = new Set<Tile>();\n\n    triggeredSuperTiles.forEach((secondarySuperTile: Tile) => {\n      const secondaryTiles = this.getTilesForSuperEffect(secondarySuperTile);\n      secondaryTiles.forEach((tile) => {\n        const tileOnBoard = this.board.getTile(tile.gridX, tile.gridY);\n        if (tileOnBoard && tileOnBoard.id === tile.id) {\n          secondWaveTiles.add(tileOnBoard);\n        }\n      });\n    });\n\n    return Array.from(secondWaveTiles);\n  }\n\n  /**\n   * Получить тайлы для удаления в зависимости от типа супер-тайла\n   */\n  private getTilesForSuperEffect(superTile: Tile): Tile[] {\n    const radius = Math.floor(GameRules.GRID_COLS / 4);\n\n    switch (superTile.superType) {\n      case SuperTileType.ROW_BLAST:\n        return this.board.getTilesInRow(superTile.gridY);\n\n      case SuperTileType.COLUMN_BLAST:\n        return this.board.getTilesInColumn(superTile.gridX);\n\n      case SuperTileType.BOMB:\n        return this.board.getTilesInRadius(\n          superTile.gridX,\n          superTile.gridY,\n          radius,\n        );\n\n      case SuperTileType.MEGA_BLAST:\n        return this.board.getAllTiles();\n\n      default:\n        return [];\n    }\n  }\n\n  /**\n   * Применить гравитацию и завершить ход\n   */\n  private applyGravityAndFinish(totalScore: number): void {\n    const oldPositions = this.saveOldPositions();\n    this.board.applyGravity();\n\n    this.boardView.animateGravityWithPositions(oldPositions, () => {\n      this.gameState.addScore(totalScore);\n      this.gameState.useMove();\n      this.gameState.checkEndConditions(this.board);\n      this.updateUI();\n      this.checkShuffleOrGameEnd();\n    });\n  }\n\n  /**\n   * Сохранить текущие позиции всех тайлов\n   */\n  private saveOldPositions(): Map<number, { x: number; y: number }> {\n    const positions = new Map();\n\n    for (let x = 0; x < this.board.cols; x++) {\n      for (let y = 0; y < this.board.rows; y++) {\n        const tile = this.board.getTile(x, y);\n        if (tile) {\n          positions.set(tile.id, { x: tile.gridX, y: tile.gridY });\n        }\n      }\n    }\n\n    return positions;\n  }\n\n  /**\n   * Обновить UI (счётчики очков и ходов)\n   */\n  private updateUI(): void {\n    if (this.scoreLabel) {\n      this.scoreLabel.string = `${this.gameState.score}/${GameRules.TARGET_SCORE}`;\n    }\n    if (this.movesLabel) {\n      this.movesLabel.string = `${this.gameState.movesLeft}`;\n    }\n  }\n\n  /**\n   * Проверка необходимости перемешивания или окончания игры\n   */\n  private checkShuffleOrGameEnd(): void {\n    const status = this.gameState.status;\n\n    if (status === GameStatus.WIN) {\n      this.showGameEndScreen(GameEndType.WIN);\n      return;\n    }\n\n    if (status === GameStatus.LOSE) {\n      this.showGameEndScreen(GameEndType.LOSE);\n      return;\n    }\n\n    if (!this.board.hasAvailableMoves()) {\n      if (this.gameState.shufflesLeft > 0) {\n        this.performShuffle();\n      } else {\n        this.showGameEndScreen(GameEndType.LOSE);\n      }\n    }\n  }\n\n  /**\n   * Выполнить перемешивание поля\n   */\n  private performShuffle(): void {\n    this.gameState.useShuffle();\n\n    const oldPositions = this.saveOldPositions();\n    this.board.shuffle();\n\n    this.boardView.animateGravityWithPositions(oldPositions, () => {\n      if (!this.board.hasAvailableMoves()) {\n        this.checkShuffleOrGameEnd();\n      }\n    });\n  }\n\n  /**\n   * Показать экран окончания игры\n   */\n  private showGameEndScreen(type: GameEndType): void {\n    this.boardView.animateAllTilesRemoval(() => {\n      this.gameEndPanel.show(type, this.restartGame.bind(this));\n    });\n  }\n\n  /**\n   * Перезапустить игру\n   */\n  private restartGame(): void {\n    this.gameState.reset();\n    this.board.generate();\n    this.boardView.renderBoard();\n    this.updateUI();\n  }\n}\n"]}