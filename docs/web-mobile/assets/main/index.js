window.__require=function e(t,o,i){function r(s,a){if(!o[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=o[s]={exports:{}};t[s][0].call(u.exports,function(e){return r(t[s][1][e]||e)},u,u.exports,e,t,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({BoardView:[function(e,t,o){"use strict";cc._RF.push(t,"80ca4omctZJbpjXYX/EO3+K","BoardView");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=e("../core/GameRules"),u=e("./TileView"),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilePrefab=null,t.fieldBorder=null,t.cellSize=100,t.spacing=0,t.board=null,t.tileViews=new Map,t.tilesContainer=null,t.maskNode=null,t}return r(t,e),t.prototype.onLoad=function(){this.createMaskContainer()},t.prototype.createMaskContainer=function(){this.maskNode||(this.maskNode=new cc.Node("MaskContainer"),this.maskNode.parent=this.node,this.maskNode.anchorX=.5,this.maskNode.anchorY=1,this.maskNode.setPosition(0,-62),this.maskNode.addComponent(cc.Mask).type=cc.Mask.Type.RECT,this.tilesContainer=new cc.Node("TilesContainer"),this.tilesContainer.parent=this.maskNode,this.tilesContainer.anchorX=.5,this.tilesContainer.anchorY=1,this.tilesContainer.setPosition(0,0))},t.prototype.init=function(e,t){this.board=e,this.onTileClickCallback=t,this.createMaskContainer();var o=this.cellSize+this.spacing,i=this.board.cols*o,r=this.board.rows*o;this.node.width=i,this.node.height=r,this.maskNode&&(this.maskNode.width=i,this.maskNode.height=r+6),this.updateFieldBorderSize(),this.renderBoard()},t.prototype.updateFieldBorderSize=function(){if(this.fieldBorder){var e=this.calculateFieldSize(),t=this.fieldBorder.scale;this.fieldBorder.width=e.width/t,this.fieldBorder.height=e.height/t}},t.prototype.calculateFieldSize=function(){var e=this.cellSize+this.spacing,t=this.board.cols*e-this.spacing+2*l.GameRules.FIELD_PADDING_SIDE,o=this.board.rows*e-this.spacing+l.GameRules.FIELD_PADDING_TOP+l.GameRules.FIELD_PADDING_BOTTOM;return cc.size(t,o)},t.prototype.renderBoard=function(){this.tilesContainer&&this.tilesContainer.removeAllChildren(),this.tileViews.clear();for(var e=0;e<this.board.cols;e++)for(var t=0;t<this.board.rows;t++){var o=this.board.getTile(e,t);o&&this.createTileView(o)}},t.prototype.createTileView=function(e){var t=this,o=cc.instantiate(this.tilePrefab),i=o.getComponent(u.default);i.setTile(e);var r=this.gridToWorldPosition(e.gridX,e.gridY);return i.setPosition(r.x,r.y),o.on(cc.Node.EventType.TOUCH_END,function(){t.onTileClicked(e.gridX,e.gridY)},this),this.tilesContainer&&this.tilesContainer.addChild(o),this.tileViews.set(e.id,i),i},t.prototype.onTileClicked=function(e,t){this.onTileClickCallback&&this.onTileClickCallback(e,t)},t.prototype.gridToWorldPosition=function(e,t){var o=this.cellSize+this.spacing,i=-this.board.cols*o/2+this.cellSize/2,r=this.board.rows*o,n=-r/2+this.cellSize/2,s=-r/2;return cc.v2(e*o+i,t*o+n+s)},t.prototype.animateRemoval=function(e,t){for(var o=0,i=e.length,r=0,n=e;r<n.length;r++){var s=n[r],a=this.tileViews.get(s.id);a&&(this.tileViews.delete(s.id),a.playDestroyAnimation(function(){++o===i&&t&&t()}))}0===i&&t&&t()},t.prototype.animateGravityWithPositions=function(e,t){for(var o=[],i=0;i<this.board.cols;i++)for(var r=0;r<this.board.rows;r++)(n=this.board.getTile(i,r))&&n.isSuper()&&!this.tileViews.has(n.id)&&this.createTileView(n);for(i=0;i<this.board.cols;i++)for(r=0;r<this.board.rows;r++){var n;if(n=this.board.getTile(i,r)){var s=e.get(n.id),a=this.tileViews.get(n.id);s||a?a&&s&&(s.x!==i||s.y!==r)&&o.push(this.animateExistingTile(a,i,r)):o.push(this.createNewTileWithAnimation(n,i,r))}}o.length>0?Promise.all(o).then(function(){t&&t()}):t&&t()},t.prototype.createNewTileWithAnimation=function(e,t,o){var i=this;return new Promise(function(r){var n=i.createTileView(e),s=i.board.rows+.3*(i.board.rows-o),a=i.gridToWorldPosition(t,s),c=i.gridToWorldPosition(t,o);n.node.setPosition(cc.v3(a.x,a.y,0)),n.node.opacity=255;var l=.05*t,u=.4+.05*o;cc.tween(n.node).delay(l).to(u,{position:cc.v3(c.x,c.y,0)},{easing:"bounceOut"}).call(function(){return r()}).start()})},t.prototype.createSuperTileWithAppearAnimation=function(e){var t=this.createTileView(e);t.node.scale=0,t.node.opacity=255,cc.tween(t.node).to(.3,{scale:1.2},{easing:"backOut"}).to(.1,{scale:1},{easing:"sineInOut"}).start()},t.prototype.animateExistingTile=function(e,t,o){var i=this;return new Promise(function(r){var n=i.gridToWorldPosition(t,o);cc.tween(e.node).to(.1,{position:cc.v3(n.x,n.y,0)},{easing:"quadIn"}).call(function(){return r()}).start()})},t.prototype.animateAllTilesRemoval=function(e){var t=this,o=Array.from(this.tileViews.values());if(0!==o.length){var i=0,r=o.length;o.forEach(function(o,n){var s=.01*n;t.scheduleOnce(function(){o.playDestroyAnimation(function(){++i===r&&e&&e()})},s)}),this.tileViews.clear()}else e&&e()},t.prototype.getTileView=function(e){return this.tileViews.get(e)||null},n([c(cc.Prefab)],t.prototype,"tilePrefab",void 0),n([c(cc.Node)],t.prototype,"fieldBorder",void 0),n([c(cc.Float)],t.prototype,"cellSize",void 0),n([c(cc.Float)],t.prototype,"spacing",void 0),n([a],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../core/GameRules":"GameRules","./TileView":"TileView"}],Board:[function(e,t,o){"use strict";cc._RF.push(t,"ac15fVzPIhOSJyZG5TY+hOg","Board"),Object.defineProperty(o,"__esModule",{value:!0}),o.Board=void 0;var i=e("./Tile"),r=e("./TileColor"),n=function(){function e(e,t){this.cols=e,this.rows=t,this.tileIdCounter=0,this.grid=[]}return e.prototype.generate=function(){for(var e=0;e<this.cols;e++){this.grid[e]=[];for(var t=0;t<this.rows;t++)this.grid[e][t]=this.createRandomTile(e,t)}},e.prototype.createRandomTile=function(e,t){var o=r.ALL_COLORS[Math.floor(Math.random()*r.ALL_COLORS.length)];return new i.Tile(o,e,t,this.tileIdCounter++)},e.prototype.getTile=function(e,t){return e<0||e>=this.cols||t<0||t>=this.rows?null:this.grid[e][t]},e.prototype.setTile=function(e,t,o){e>=0&&e<this.cols&&t>=0&&t<this.rows&&(this.grid[e][t]=o,o&&(o.gridX=e,o.gridY=t))},e.prototype.findConnectedGroup=function(e,t){var o=this.getTile(e,t);if(!o)return[];var i=o.color,r=[],n=new Set,s=[o];for(n.add(e+","+t);s.length>0;){var a=s.shift();r.push(a);for(var c=0,l=this.getNeighbors(a.gridX,a.gridY);c<l.length;c++){var u=l[c],p=u.gridX+","+u.gridY;u.color!==i||n.has(p)||(n.add(p),s.push(u))}}return r},e.prototype.getNeighbors=function(e,t){for(var o=[],i=0,r=[[0,1],[0,-1],[-1,0],[1,0]];i<r.length;i++){var n=r[i],s=n[0],a=n[1],c=this.getTile(e+s,t+a);c&&o.push(c)}return o},e.prototype.hasAvailableMoves=function(){for(var e=0;e<this.cols;e++)for(var t=0;t<this.rows;t++)if(this.getTile(e,t)&&this.findConnectedGroup(e,t).length>=2)return!0;return!1},e.prototype.createSuperTile=function(e,t,o,r){var n=new i.Tile(r,e,t,this.tileIdCounter++,o);return this.setTile(e,t,n),n},e.prototype.getTilesInRow=function(e){for(var t=[],o=0;o<this.cols;o++){var i=this.getTile(o,e);i&&t.push(i)}return t},e.prototype.getTilesInColumn=function(e){for(var t=[],o=0;o<this.rows;o++){var i=this.getTile(e,o);i&&t.push(i)}return t},e.prototype.getTilesInRadius=function(e,t,o){for(var i=[],r=0;r<this.cols;r++)for(var n=0;n<this.rows;n++)if(Math.sqrt(Math.pow(r-e,2)+Math.pow(n-t,2))<=o){var s=this.getTile(r,n);s&&i.push(s)}return i},e.prototype.getAllTiles=function(){for(var e=[],t=0;t<this.cols;t++)for(var o=0;o<this.rows;o++){var i=this.getTile(t,o);i&&e.push(i)}return e},e.prototype.shuffle=function(){for(var e,t=[],o=0;o<this.cols;o++)for(var i=0;i<this.rows;i++){var r=this.getTile(o,i);r&&t.push(r)}for(var n=t.length-1;n>0;n--){var s=Math.floor(Math.random()*(n+1));e=[t[s],t[n]],t[n]=e[0],t[s]=e[1]}var a=0;for(o=0;o<this.cols;o++)for(i=0;i<this.rows;i++)this.setTile(o,i,t[a++])},e.prototype.removeTiles=function(e){for(var t=0,o=e;t<o.length;t++){var i=o[t];this.setTile(i.gridX,i.gridY,null)}},e.prototype.applyGravity=function(){for(var e=0,t=0;t<this.cols;t++){for(var o=[],i=0;i<this.rows;i++){var r=this.grid[t][i];r&&o.push(r)}for(i=0;i<this.rows;i++)this.grid[t][i]=null;var n=0;for(i=0;i<this.rows;i++)n<o.length?(this.setTile(t,i,o[n]),n++,e++):(this.setTile(t,i,this.createRandomTile(t,i)),e++)}return e},e}();o.Board=n,cc._RF.pop()},{"./Tile":"Tile","./TileColor":"TileColor"}],BoosterPanel:[function(e,t,o){"use strict";cc._RF.push(t,"a263bHBqc1DiIeqkTQriS3e","BoosterPanel");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../ui/BusterButton"),a=cc._decorator,c=a.ccclass,l=a.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boosterButtonPrefab=null,t.boosterContainer=null,t.bombIcon=null,t.teleportIcon=null,t.boosterButtons=new Map,t}return r(t,e),t.prototype.onLoad=function(){this.createBoosters()},t.prototype.createBoosters=function(){var e=this,t=[{type:"bomb",icon:this.bombIcon,count:3},{type:"teleport",icon:this.teleportIcon,count:5}],o=-320*(t.length-1)/2;t.forEach(function(t,i){var r=cc.instantiate(e.boosterButtonPrefab);r.parent=e.boosterContainer,r.x=o+320*i,r.y=0;var n=r.getComponent(s.default);n&&(n.init(t.type,t.icon,t.count),e.boosterButtons.set(t.type,n),r.on("booster-clicked",e.onBoosterClicked,e))})},t.prototype.onBoosterClicked=function(e){var t=this.boosterButtons.get(e);if(t){var o=parseInt(t.countLabel.string);o<=0||t.updateCount(o-1)}},n([l(cc.Prefab)],t.prototype,"boosterButtonPrefab",void 0),n([l(cc.Node)],t.prototype,"boosterContainer",void 0),n([l(cc.SpriteFrame)],t.prototype,"bombIcon",void 0),n([l(cc.SpriteFrame)],t.prototype,"teleportIcon",void 0),n([c],t)}(cc.Component);o.default=u,cc._RF.pop()},{"../ui/BusterButton":"BusterButton"}],BusterButton:[function(e,t,o){"use strict";cc._RF.push(t,"3bafaJQ7BNLIbl5SsemeUHo","BusterButton");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.icon=null,t.countLabel=null,t.boosterType="",t}return r(t,e),t.prototype.init=function(e,t,o){this.boosterType=e,this.updateCount(o),t&&(this.icon.spriteFrame=t),this.node.on(cc.Node.EventType.TOUCH_START,this.onClick,this)},t.prototype.onClick=function(){this.node.emit("booster-clicked",this.boosterType)},t.prototype.updateCount=function(e){this.countLabel.string=e.toString(),this.node.opacity=e>0?255:128},t.prototype.getType=function(){return this.boosterType},n([c(cc.Sprite)],t.prototype,"icon",void 0),n([c(cc.Label)],t.prototype,"countLabel",void 0),n([a],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],GameController:[function(e,t,o){"use strict";cc._RF.push(t,"338a3xaV/9A45ZDJX3iod4J","GameController");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=e("../core/Board"),u=e("../core/GameState"),p=e("../core/GameRules"),h=e("../view/BoardView"),d=e("../ui/GameEndPanel"),f=e("../core/Tile"),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boardView=null,t.scoreLabel=null,t.movesLabel=null,t.gameEndPanelNode=null,t.gameEndPanel=null,t}return r(t,e),t.prototype.onLoad=function(){this.board=new l.Board(p.GameRules.GRID_COLS,p.GameRules.GRID_ROWS),this.gameState=new u.GameState,this.board.generate(),this.boardView.init(this.board,this.onTileClicked.bind(this)),this.updateUI()},t.prototype.start=function(){this.gameEndPanelNode&&(this.gameEndPanel=this.gameEndPanelNode.getComponent(d.default))},t.prototype.onTileClicked=function(e,t){var o=this;if(this.gameState.isPlaying()){var i=this.board.getTile(e,t);if(i)if(i.isSuper())this.activateSuperTile(i);else{var r=this.board.findConnectedGroup(e,t);if(p.GameRules.isValidGroup(r.length)){var n=p.GameRules.shouldCreateSuperTile(r.length),s=p.GameRules.getSuperTileType(r.length),a=i.color,c=e,l=t;this.boardView.animateRemoval(r,function(){if(o.board.removeTiles(r),n&&s!==f.SuperTileType.NONE){var e=o.board.createSuperTile(c,l,s,a);o.boardView.createSuperTileWithAppearAnimation(e)}o.scheduleOnce(function(){var e=o.saveOldPositions();o.board.applyGravity(),o.boardView.animateGravityWithPositions(e,function(){o.gameState.addScore(r.length),o.gameState.useMove(),o.gameState.checkEndConditions(o.board),o.updateUI(),o.checkShuffleOrGameEnd()})},.3)})}}}},t.prototype.activateSuperTile=function(e){var t=this,o=this.getTilesForSuperEffect(e);if(0!==o.length){var i=o.filter(function(t){return t.isSuper()&&t.id!==e.id});this.boardView.animateRemoval(o,function(){t.board.removeTiles(o),i.length>0?t.scheduleOnce(function(){var e=t.collectSecondWaveTiles(i);e.length>0?t.boardView.animateRemoval(e,function(){t.board.removeTiles(e),t.applyGravityAndFinish(o.length+e.length)}):t.applyGravityAndFinish(o.length)},.1):t.applyGravityAndFinish(o.length)})}},t.prototype.collectSecondWaveTiles=function(e){var t=this,o=new Set;return e.forEach(function(e){t.getTilesForSuperEffect(e).forEach(function(e){var i=t.board.getTile(e.gridX,e.gridY);i&&i.id===e.id&&o.add(i)})}),Array.from(o)},t.prototype.getTilesForSuperEffect=function(e){var t=Math.floor(p.GameRules.GRID_COLS/4);switch(e.superType){case f.SuperTileType.ROW_BLAST:return this.board.getTilesInRow(e.gridY);case f.SuperTileType.COLUMN_BLAST:return this.board.getTilesInColumn(e.gridX);case f.SuperTileType.BOMB:return this.board.getTilesInRadius(e.gridX,e.gridY,t);case f.SuperTileType.MEGA_BLAST:return this.board.getAllTiles();default:return[]}},t.prototype.applyGravityAndFinish=function(e){var t=this,o=this.saveOldPositions();this.board.applyGravity(),this.boardView.animateGravityWithPositions(o,function(){t.gameState.addScore(e),t.gameState.useMove(),t.gameState.checkEndConditions(t.board),t.updateUI(),t.checkShuffleOrGameEnd()})},t.prototype.saveOldPositions=function(){for(var e=new Map,t=0;t<this.board.cols;t++)for(var o=0;o<this.board.rows;o++){var i=this.board.getTile(t,o);i&&e.set(i.id,{x:i.gridX,y:i.gridY})}return e},t.prototype.updateUI=function(){this.scoreLabel&&(this.scoreLabel.string=this.gameState.score+"/"+p.GameRules.TARGET_SCORE),this.movesLabel&&(this.movesLabel.string=""+this.gameState.movesLeft)},t.prototype.checkShuffleOrGameEnd=function(){var e=this.gameState.status;e!==u.GameStatus.WIN?e!==u.GameStatus.LOSE?this.board.hasAvailableMoves()||(this.gameState.shufflesLeft>0?this.performShuffle():this.showGameEndScreen(d.GameEndType.LOSE)):this.showGameEndScreen(d.GameEndType.LOSE):this.showGameEndScreen(d.GameEndType.WIN)},t.prototype.performShuffle=function(){var e=this;this.gameState.useShuffle();var t=this.saveOldPositions();this.board.shuffle(),this.boardView.animateGravityWithPositions(t,function(){e.board.hasAvailableMoves()||e.checkShuffleOrGameEnd()})},t.prototype.showGameEndScreen=function(e){var t=this;this.boardView.animateAllTilesRemoval(function(){t.gameEndPanel.show(e,t.restartGame.bind(t))})},t.prototype.restartGame=function(){this.gameState.reset(),this.board.generate(),this.boardView.renderBoard(),this.updateUI()},n([c(h.default)],t.prototype,"boardView",void 0),n([c(cc.Label)],t.prototype,"scoreLabel",void 0),n([c(cc.Label)],t.prototype,"movesLabel",void 0),n([c(cc.Node)],t.prototype,"gameEndPanelNode",void 0),n([a],t)}(cc.Component);o.default=y,cc._RF.pop()},{"../core/Board":"Board","../core/GameRules":"GameRules","../core/GameState":"GameState","../core/Tile":"Tile","../ui/GameEndPanel":"GameEndPanel","../view/BoardView":"BoardView"}],GameEndPanel:[function(e,t,o){"use strict";cc._RF.push(t,"1aa5atl8HNOW5h7eJA0UkbC","GameEndPanel");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.GameEndType=void 0;var s,a=cc._decorator,c=a.ccclass,l=a.property;(function(e){e.WIN="win",e.LOSE="lose"})(s=o.GameEndType||(o.GameEndType={}));var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resultLabel=null,t.restartButton=null,t.onRestartCallback=null,t}return r(t,e),t.prototype.onLoad=function(){this.node.opacity=0,this.node.active=!1,this.restartButton.node.on("click",this.onRestartClicked,this)},t.prototype.show=function(e,t){this.onRestartCallback=t,this.node.active=!0,e===s.WIN?this.resultLabel.string="\u0422\u042b \u0412\u042b\u0418\u0413\u0420\u0410\u041b!\n\ud83c\udf89":this.resultLabel.string="\u041f\u0420\u041e\u0418\u0413\u0420\u042b\u0428",this.playShowAnimation()},t.prototype.hide=function(){this.node.active=!1,this.node.opacity=0},t.prototype.playShowAnimation=function(){this.resultLabel.node.scale=.5,this.resultLabel.node.opacity=0,this.restartButton.node.scale=.8,this.restartButton.node.opacity=0,this.node.opacity=255,cc.tween(this.resultLabel.node).to(.4,{scale:1,opacity:255},{easing:"backOut"}).start(),cc.tween(this.restartButton.node).delay(.2).to(.3,{scale:1,opacity:255},{easing:"backOut"}).start()},t.prototype.onRestartClicked=function(){var e=this;cc.tween(this.node).to(.2,{opacity:0}).call(function(){e.hide(),e.onRestartCallback&&e.onRestartCallback()}).start()},n([l(cc.Label)],t.prototype,"resultLabel",void 0),n([l(cc.Button)],t.prototype,"restartButton",void 0),n([c],t)}(cc.Component);o.default=u,cc._RF.pop()},{}],GameRules:[function(e,t,o){"use strict";cc._RF.push(t,"051e0V/wrpOcpxE/Tl0HYAP","GameRules"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameRules=void 0;var i=e("./Tile"),r=function(){function e(){}return e.calculateScore=function(e){return e<this.MIN_GROUP_SIZE?0:e*e*2},e.isValidGroup=function(e){return e>=this.MIN_GROUP_SIZE},e.getSuperTileType=function(e){return e>=this.MEGA_BLAST_THRESHOLD?i.SuperTileType.MEGA_BLAST:e>=this.BOMB_THRESHOLD?i.SuperTileType.BOMB:e>=this.COLUMN_BLAST_THRESHOLD?i.SuperTileType.COLUMN_BLAST:e>=this.ROW_BLAST_THRESHOLD?i.SuperTileType.ROW_BLAST:i.SuperTileType.NONE},e.shouldCreateSuperTile=function(e){return e>=this.SUPER_TILE_MIN_GROUP},e.GRID_COLS=9,e.GRID_ROWS=9,e.TILE_SIZE=100,e.TILE_SPACING=0,e.FIELD_PADDING_SIDE=41,e.FIELD_PADDING_TOP=70,e.FIELD_PADDING_BOTTOM=58,e.TILE_VISUAL_OFFSET_Y=12,e.MAX_SHUFFLES=3,e.TARGET_SCORE=1e3,e.MAX_MOVES=20,e.MIN_GROUP_SIZE=2,e.SUPER_TILE_MIN_GROUP=5,e.ROW_BLAST_THRESHOLD=5,e.COLUMN_BLAST_THRESHOLD=6,e.BOMB_THRESHOLD=7,e.MEGA_BLAST_THRESHOLD=9,e}();o.GameRules=r,cc._RF.pop()},{"./Tile":"Tile"}],GameState:[function(e,t,o){"use strict";cc._RF.push(t,"bda90y7/05DdrhdJBUNKhZE","GameState"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameState=o.GameStatus=void 0;var i,r=e("./GameRules");(function(e){e.PLAYING="playing",e.WIN="win",e.LOSE="lose"})(i=o.GameStatus||(o.GameStatus={}));var n=function(){function e(){this._score=0,this._movesLeft=r.GameRules.MAX_MOVES,this._status=i.PLAYING,this._shufflesLeft=r.GameRules.MAX_SHUFFLES}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movesLeft",{get:function(){return this._movesLeft},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shufflesLeft",{get:function(){return this._shufflesLeft},enumerable:!1,configurable:!0}),e.prototype.isPlaying=function(){return this._status===i.PLAYING},e.prototype.addScore=function(e){var t=r.GameRules.calculateScore(e);this._score+=t},e.prototype.useMove=function(){this._movesLeft>0&&this._movesLeft--},e.prototype.useShuffle=function(){this._shufflesLeft>0&&this._shufflesLeft--},e.prototype.checkEndConditions=function(e){this._status===i.PLAYING&&(this._score>=r.GameRules.TARGET_SCORE?this._status=i.WIN:this._movesLeft<=0?this._status=i.LOSE:!e.hasAvailableMoves()&&this._shufflesLeft<=0&&(this._status=i.LOSE))},e.prototype.reset=function(){this._score=0,this._movesLeft=r.GameRules.MAX_MOVES,this._status=i.PLAYING,this._shufflesLeft=r.GameRules.MAX_SHUFFLES},e}();o.GameState=n,cc._RF.pop()},{"./GameRules":"GameRules"}],TileColor:[function(e,t,o){"use strict";var i;cc._RF.push(t,"29066LBzIRPL4kbxd052RJj","TileColor"),Object.defineProperty(o,"__esModule",{value:!0}),o.ALL_COLORS=o.TileColor=void 0,function(e){e.RED="red",e.BLUE="blue",e.GREEN="green",e.YELLOW="yellow",e.PURPLE="purple"}(i=o.TileColor||(o.TileColor={})),o.ALL_COLORS=Object.values(i),cc._RF.pop()},{}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"13eeeq9xZFIeqoyiMv1hf4p","TileView");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=e("../core/Tile"),u=e("../core/TileColor"),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.tileTextures=[],t.superTileTextures=[],t.tile=null,t}return r(t,e),t.prototype.setTile=function(e){this.tile=e,this.updateVisual()},t.prototype.getTile=function(){return this.tile},t.prototype.updateVisual=function(){var e,t;if(this.tile&&this.sprite)if(this.tile.isSuper())this.setSuperTileVisual();else{var o=((e={})[u.TileColor.RED]=0,e[u.TileColor.BLUE]=1,e[u.TileColor.GREEN]=2,e[u.TileColor.YELLOW]=3,e[u.TileColor.PURPLE]=4,e)[this.tile.color];if(this.tileTextures.length>0&&this.tileTextures[o])this.sprite.spriteFrame=this.tileTextures[o],this.sprite.node.color=cc.Color.WHITE;else{var i=((t={})[u.TileColor.RED]=cc.Color.RED,t[u.TileColor.BLUE]=cc.Color.BLUE,t[u.TileColor.GREEN]=cc.Color.GREEN,t[u.TileColor.YELLOW]=cc.Color.YELLOW,t[u.TileColor.PURPLE]=new cc.Color(150,50,200),t);this.sprite.node.color=i[this.tile.color]||cc.Color.WHITE}}},t.prototype.setSuperTileVisual=function(){var e,t=((e={})[l.SuperTileType.ROW_BLAST]=0,e[l.SuperTileType.COLUMN_BLAST]=1,e[l.SuperTileType.BOMB]=2,e[l.SuperTileType.MEGA_BLAST]=3,e)[this.tile.superType];this.superTileTextures.length>0&&this.superTileTextures[t]?(this.sprite.spriteFrame=this.superTileTextures[t],this.sprite.node.color=cc.Color.WHITE):(this.updateVisual(),this.sprite.node.color=cc.Color.WHITE,this.sprite.node.opacity=255,this.addSuperTileEffect())},t.prototype.addSuperTileEffect=function(){cc.tween(this.node).repeatForever(cc.tween().to(.5,{scale:1.1},{easing:"sineInOut"}).to(.5,{scale:1},{easing:"sineInOut"})).start()},t.prototype.setPosition=function(e,t){this.node.setPosition(e,t)},t.prototype.playDestroyAnimation=function(e){var t=this;cc.tween(this.node).to(.2,{scale:0,opacity:0}).call(function(){t.node.destroy(),e&&e()}).start()},t.prototype.playFallAnimation=function(e,t,o,i){cc.tween(this.node).to(o,{position:cc.v3(e,t,0)},{easing:"bounceOut"}).call(function(){i&&i()}).start()},n([c(cc.Sprite)],t.prototype,"sprite",void 0),n([c([cc.SpriteFrame])],t.prototype,"tileTextures",void 0),n([c([cc.SpriteFrame])],t.prototype,"superTileTextures",void 0),n([a],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../core/Tile":"Tile","../core/TileColor":"TileColor"}],Tile:[function(e,t,o){"use strict";var i;cc._RF.push(t,"2cef4zMrNZLUqATAYF5DCnO","Tile"),Object.defineProperty(o,"__esModule",{value:!0}),o.Tile=o.SuperTileType=void 0,function(e){e.NONE="none",e.ROW_BLAST="row",e.COLUMN_BLAST="column",e.BOMB="bomb",e.MEGA_BLAST="mega"}(i=o.SuperTileType||(o.SuperTileType={}));var r=function(){function e(e,t,o,r,n){void 0===n&&(n=i.NONE),this.color=e,this.gridX=t,this.gridY=o,this.id=r,this.superType=n}return e.prototype.isSuper=function(){return this.superType!==i.NONE},e.prototype.isAdjacentTo=function(e){var t=Math.abs(this.gridX-e.gridX),o=Math.abs(this.gridY-e.gridY);return 1===t&&0===o||0===t&&1===o},e.prototype.toString=function(){var e=this.isSuper()?" [SUPER:"+this.superType+"]":"";return"Tile["+this.id+"]("+this.color+" at "+this.gridX+","+this.gridY+")"+e},e}();o.Tile=r,cc._RF.pop()},{}]},{},["GameController","Board","GameRules","GameState","Tile","TileColor","BusterButton","GameEndPanel","BoardView","BoosterPanel","TileView"]);